{"title":"python之openpyxl函数","slug":"python之openpyxl函数","date":"2020-02-07T09:12:41.000Z","updated":"2020-02-07T09:25:50.183Z","comments":true,"path":"api/articles/python之openpyxl函数.json","photos":[],"link":"","excerpt":null,"covers":null,"content":"<h3 id=\"openpyxl\"><a href=\"#openpyxl\" class=\"headerlink\" title=\"openpyxl\"></a>openpyxl</h3><h3 id=\"1-Excel-文件也被称为-工作簿（workbook），每个工作簿中可以新建多个-工作表（worksheet）。而每个工作表中又有很多个-单元格-组成，每个单元格通过列和行来定位，比如第一个单元格被称为-A1-单元格。\"><a href=\"#1-Excel-文件也被称为-工作簿（workbook），每个工作簿中可以新建多个-工作表（worksheet）。而每个工作表中又有很多个-单元格-组成，每个单元格通过列和行来定位，比如第一个单元格被称为-A1-单元格。\" class=\"headerlink\" title=\"1.Excel 文件也被称为 工作簿（workbook），每个工作簿中可以新建多个 工作表（worksheet）。而每个工作表中又有很多个 单元格 组成，每个单元格通过列和行来定位，比如第一个单元格被称为 A1 单元格。\"></a>1.Excel 文件也被称为 工作簿（workbook），每个工作簿中可以新建多个 工作表（worksheet）。而每个工作表中又有很多个 单元格 组成，每个单元格通过列和行来定位，比如第一个单元格被称为 A1 单元格。</h3><h3 id=\"openpyxl-写文件\"><a href=\"#openpyxl-写文件\" class=\"headerlink\" title=\"openpyxl 写文件\"></a>openpyxl 写文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">from openpyxl import Workbook # 从 openpyxl 引入 Workbook（工作簿）类</span><br><span class=\"line\">wb = Workbook() # 实列化工作簿</span><br><span class=\"line\">sheet = wb.active # 选择默认工作表</span><br><span class=\"line\">sheet.title = &apos;小周日报&apos; # 给工作表重命名</span><br><span class=\"line\"></span><br><span class=\"line\">data = [</span><br><span class=\"line\">[&apos;课程&apos;, &apos;天数&apos;],</span><br><span class=\"line\">[&apos;python&apos;, &apos;12&apos;],</span><br><span class=\"line\">[&apos;javascript&apos;, &apos;15&apos;]</span><br><span class=\"line\">]</span><br><span class=\"line\"># 写入多行数据</span><br><span class=\"line\">for row in data:</span><br><span class=\"line\">sheet.append(row)</span><br><span class=\"line\"># 保存excel 文件</span><br><span class=\"line\">wb.save(&apos;小周的编程计划.xls&apos;)</span><br></pre></td></tr></table></figure>\n<h3 id=\"openpyxl-读文件\"><a href=\"#openpyxl-读文件\" class=\"headerlink\" title=\"openpyxl 读文件\"></a>openpyxl 读文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">from openpyxl import load_workbook</span><br><span class=\"line\"># 打开 Excel 文件</span><br><span class=\"line\">wb = load_workbook(&apos;考勤统计.xlsx&apos;)</span><br><span class=\"line\"># 选择考勤统计表这张工作表</span><br><span class=\"line\">sheet = wb[&apos;考勤统计表&apos;]</span><br><span class=\"line\"># 打印出所有工作表名称</span><br><span class=\"line\">print(wb.sheetnames)</span><br><span class=\"line\"># 输出：[&apos;考勤统计表&apos;]</span><br></pre></td></tr></table></figure>\n<h4 id=\"Excel-文件写入步骤\"><a href=\"#Excel-文件写入步骤\" class=\"headerlink\" title=\"Excel 文件写入步骤\"></a>Excel 文件写入步骤</h4><ol>\n<li>创建工作簿  wb = openpyxl.Workbook()</li>\n<li>选择工作表  sheet = wb.active 或 wb[‘工作表’]</li>\n<li>操作单元格 sheet[‘A1’] =1 或sheet.append[1,2,3]</li>\n<li><p>保存工作簿 wb.save(‘文件名.xlsx’)</p>\n<h3 id=\"2-csv\"><a href=\"#2-csv\" class=\"headerlink\" title=\"2.csv\"></a>2.csv</h3><p>CSV 全称 Comma-Separated Values（逗号分隔值），它是一种通用的、相对简单的文件格式，被用户、商业和科学广泛应用。</p>\n</li>\n</ol>\n<p>和 JSON 一样，CSV 也是按照一定规范书写的文本。xlsx 格式的文件是二进制的，只能被 Excel 打开。而 csv 格式的文件是纯文本，你甚至可以用记事本打开它。当用 Excel 打开 csv 文件时，会将其解析成表格形式展示。</p>\n<p>和 xlsx 文件相比，csv 文件占用空间和内容小，打开的速度也更快。但 csv 文件功能受限，不能存储图表、公式、图片等。</p>\n<h3 id=\"2-1-csv-读文件\"><a href=\"#2-1-csv-读文件\" class=\"headerlink\" title=\"2.1 csv 读文件\"></a>2.1 csv 读文件</h3><p>首先通过 import csv 导入 csv 库，然后用 open() 函数打开 csv 文件，将得到的 file 对象传入 csv.reader() 方法进行处理，最终得到一个可读取对象。我们可以用 for 循环遍历得到的可读取对象 csv_reader 获取 csv 文件中的每一行数据。<br>注意：open() 函数中的第二个参数 newline=’’ 是为了让文件内容中的换行符能被正确解析，建议在用 csv 处理文件时都加上这个参数。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import csv</span><br><span class=\"line\">with open(&apos;考勤统计表.csv&apos;, newline=&apos;&apos;) as file:</span><br><span class=\"line\">csv_reader = csv.reader(file)</span><br><span class=\"line\">for row in csv_reader:</span><br><span class=\"line\">print(row)</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"2-2-csv写文件\"><a href=\"#2-2-csv写文件\" class=\"headerlink\" title=\"2.2 csv写文件\"></a>2.2 csv写文件</h3><p>csv 还提供了一个更加快捷的写入多行内容的方法——writerows()，通过该方法不再需要使用 for 循环，直接将多行数据的二维列表传进去即可.<br>后面两句  等同于   csv_writer.writerows(data)<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import csv</span><br><span class=\"line\"></span><br><span class=\"line\">with open(&apos;测试.csv&apos;, &apos;w&apos;, &apos;newline&apos;) as file:</span><br><span class=\"line\">csv_writer = csv.writer(file)</span><br><span class=\"line\">data = [</span><br><span class=\"line\">[&apos;测试&apos;, &apos;天数&apos;],</span><br><span class=\"line\">[&apos;python&apos;, 12],</span><br><span class=\"line\">[&apos;测试&apos;, &apos;天数&apos;]</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\">for row in data:</span><br><span class=\"line\">csv_writer.writerow(row)</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"猜猜这是什么呢-哈哈哈哈哈。。\"><a href=\"#猜猜这是什么呢-哈哈哈哈哈。。\" class=\"headerlink\" title=\"猜猜这是什么呢  哈哈哈哈哈。。\"></a>猜猜这是什么呢  哈哈哈哈哈。。</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import requests</span><br><span class=\"line\">from openpyxl import Workbook</span><br><span class=\"line\">from datetime import datetime</span><br><span class=\"line\">import time</span><br><span class=\"line\"></span><br><span class=\"line\">headers = &#123;</span><br><span class=\"line\">&apos;user-agent&apos;:&apos;Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1&apos;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">wb = Workbook()</span><br><span class=\"line\">sheet = wb.active</span><br><span class=\"line\">sheet.title = &apos;等你下课.xls&apos;</span><br><span class=\"line\">header = [&apos;评论人昵称&apos;,&apos;评论时间&apos;,&apos;评论内容&apos;]</span><br><span class=\"line\">sheet.append(header)</span><br><span class=\"line\"></span><br><span class=\"line\">for pagenum in range(5):</span><br><span class=\"line\"> lasthotcommentid=&apos;&apos;</span><br><span class=\"line\"> params = &#123;</span><br><span class=\"line\"> &apos;g_tk&apos;: &apos;5381&apos;,</span><br><span class=\"line\"> &apos;loginUin&apos;: &apos;0&apos;,</span><br><span class=\"line\"> &apos;hostUin&apos;: &apos;0&apos;,</span><br><span class=\"line\"> &apos;format&apos;: &apos;json&apos;,</span><br><span class=\"line\"> &apos;inCharset&apos;: &apos;utf8&apos;,</span><br><span class=\"line\"> &apos;outCharset&apos;: &apos;GB2312&apos;,</span><br><span class=\"line\"> &apos;notice&apos;: &apos;0&apos;,</span><br><span class=\"line\"> &apos;platform&apos;: &apos;yqq.json&apos;,</span><br><span class=\"line\"> &apos;needNewCode&apos;: &apos;0&apos;,</span><br><span class=\"line\"> &apos;cid&apos;: &apos;205360772&apos;,</span><br><span class=\"line\"> &apos;reqtype&apos;: &apos;2&apos;,</span><br><span class=\"line\"> &apos;biztype&apos;: &apos;1&apos;,</span><br><span class=\"line\"> topid&apos;: &apos;212877900&apos;,</span><br><span class=\"line\"> &apos;cmd&apos;: &apos;8&apos;,</span><br><span class=\"line\"> &apos;needmusiccrit&apos;: &apos;0&apos;,</span><br><span class=\"line\"> &apos;pagenum&apos;: pagenum,</span><br><span class=\"line\"> &apos;pagesize&apos;: &apos;25&apos;,</span><br><span class=\"line\"> &apos;lasthotcommentid&apos;: lasthotcommentid,</span><br><span class=\"line\"> &apos;domain&apos;: &apos;qq.com&apos;,</span><br><span class=\"line\"> &apos;ct&apos;: &apos;24&apos;,</span><br><span class=\"line\"> &apos;cv&apos;: &apos;10101010&apos;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">res = requests.get(&apos;https://c.y.qq.com/base/fcgi-bin/fcg_global_comment_h5.fcg&apos;, headers=headers, params=params)</span><br><span class=\"line\">data = res.json()</span><br><span class=\"line\">for item in data[&apos;comment&apos;][&apos;commentlist&apos;]:</span><br><span class=\"line\">  nick = item[&apos;nick&apos;]</span><br><span class=\"line\">  times = datetime.fromtimestamp(item[&apos;time&apos;])</span><br><span class=\"line\">  content=item[&apos;rootcommentcontent&apos;]</span><br><span class=\"line\"></span><br><span class=\"line\">row= [nick,times,content]</span><br><span class=\"line\">sheet.append(row)</span><br><span class=\"line\">print(nick,times,content)</span><br><span class=\"line\">wb.save(&apos;等你下课.xls&apos;)</span><br></pre></td></tr></table></figure>\n","categories":[],"tags":[{"name":"python","slug":"python","count":3,"path":"api/tags/python.json"}]}